(()=>{let t=location.href,e=parseInt(t.substring(t.indexOf("index="),t.indexOf("like=")).replace(/[^0-9]/gi,"")),i=t[t.indexOf("like=")+5],s=parseInt(t.substring(t.indexOf("userId=")).replace(/[^0-9]/gi,""));new Vue({el:"#app",data:{merchIndex:1,index:e+1,likeOrNot:i,userId:s,userLike:[],userName:"",merchData:{id:0,merchPicSrc:"",merchName:"",merchPrice:"",like:"",description:"",quantity:0,comments:[]},quantity:0,newComments:"",shoppingList:[],merches:[],collection:[]},methods:{changeLike(){if("t"==this.likeOrNot){this.likeOrNot="f",this.userLike.splice(this.userLike.indexOf(this.index),1);let t=this.userLike.join("|");document.cookie=`like=${t};max-age=3600*24`,axios.patch(`http://localhost:5000/members/${this.userId}`,{like:this.userLike}).then((t=>{console.log(t)}))}else{this.likeOrNot="t",this.userLike.push(this.index);let t=this.userLike.join("|");document.cookie=`like=${t};max-age=3600*24`,axios.patch(`http://localhost:5000/members/${this.userId}`,{like:this.userLike})}},minus(){this.quantity>=0?this.quantity--:this.quantity=0},plus(){this.quantity++},submit_comments(){this.newComments.length?(this.merchData.comments.push({user:this.userName,text:this.newComments}),axios.patch(`http://localhost:5000/merches/${this.index}`,{comments:this.merchData.comments}).then((t=>{this.newComments=""}))):swal("內容為空","","error")},backToHomepage(){location.href="index.html"},addToCart(){this.shoppingList.filter((t=>{if(t.id==this.index)return t.quantity+=this.quantity,t})).length||this.shoppingList.push({id:this.index,quantity:this.quantity}),axios.patch(`http://localhost:5000/members/${this.userId}`,{shoppingCart:this.shoppingList}).then((t=>{console.log(t),swal.fire("已新增至購物車!","","success")}))},checkUserData(){location.href=`userData.html?id=${this.userId}`},goToMerch(t){location.href=`merch.html?index=${t-1}like=${this.merches[t-1].like}userId=${this.userData.id}`},logOut(){Swal.fire({title:"確認登出?",showCancelButton:!0}).then((function(t){t.value?(document.cookie=`id=;expire${Date.toGMTString}`,document.cookie=`userName=;expire${Date.toGMTString}`,document.cookie=`like=;expire${Date.toGMTString}`,document.cookie=`shoppingCart=;expire${Date.toGMTString}`,location.href="login.html"):Swal.fire("您取消了登出")}))},shoppingCart(){location.href="shoppingCart.html"},showCollection(){axios.get("http://localhost:5000/merches").then((t=>{console.log(this.userLike.length);for(let e=0;e<this.userLike.length;e++)this.collection.push(t.data[this.userLike[e]-1]);console.log(this.collection)}))},checkOrder(){location.href="orders.html"}},mounted(){let t=document.cookie.split(";");t.filter((t=>{if(-1!=t.indexOf("id="))return t})).length||(location.href="login.html");for(let e=0;e<t.length;e++)t[e].trim();axios.get(`http://localhost:5000/merches?id=${this.index}`).then((t=>{this.merchData=t.data[0],console.log(this.merchData)})),axios.get(`http://localhost:5000/members?id=${this.userId}`).then((t=>{t.data[0].like&&(this.userLike=t.data[0].like,console.log(this.userLike)),this.userName=t.data[0].userName,this.shoppingList=t.data[0].shoppingCart,this.showCollection()}))},watch:{quantity:function(t,e){this.quantity<0?(swal.fire("購買數量不可小於0","","warning"),this.quantity=0):this.quantity>this.merchData.quantity&&(swal.fire("購買數量已達上限","","warning"),this.quantity=this.merchData.quantity)}}})})();